version: "3"
services:
    mmo-server:
        build: ./mmo-server/.
        command: bash -c "cd /release/ && ./mmo-server --address 0.0.0.0:8080"
        ports:
            - "8080:8080"
        volumes: 
            - ./mmo-server:/opt/mmo-server/src
        networks:
            app_net:
                ipv4_address: 172.16.238.10
    mmo-client:
        build: ./mmo-client/.
        command: bash -c "cd /release/ && ./mmo-client --address 0.0.0.0:8080"
        ports:
            - "8081:8080"
        volumes: 
            - ./mmo-client:/opt/mmo-client/src
        networks:
            app_net:
                ipv4_address: 172.16.238.11
    mmo-mumble:
        build: ./mmo-mumble/.
        command: bash -c "cd /release/ && ./mmo-mumble --address 0.0.0.0:8080"
        ports:
            - "8082:8080"
        volumes: 
            - ./mmo-mumble:/opt/mmo-mumble/src
        networks:
            app_net:
                ipv4_address: 172.16.238.12
    web:
        image: nginx
        volumes:
            - "/c/Users/Public/sites:/usr/share/nginx/html"
            - "/c/Users/Public/sites/mysite.template:/etc/nginx/conf.d/mysite.template"
        ports:
            - "80:80"
        environment:
            - NGINX_HOST=foobar.com
            - NGINX_PORT=80
        command: /bin/bash -c "envsubst < /etc/nginx/conf.d/mysite.template > /etc/nginx/conf.d/default.conf && exec nginx -g 'daemon off;'"
        networks:
            app_net:
                ipv4_address: 172.16.238.13
networks:
    app_net:
        ipam:
            driver: default
            config:
                - subnet: 172.28.0.0/16